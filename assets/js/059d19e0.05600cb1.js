"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[63560],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var t=s(96540);const a={},i=t.createContext(a);function r(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:n},e.children)}},35214:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"core-concepts/gameloop-architecture","title":"Game Loop Architecture","description":"Commands, Events, double-buffered EventBus, and ImmediateBus for decoupled game systems.","source":"@site/docs/core-concepts/gameloop-architecture.md","sourceDirName":"core-concepts","slug":"/core-concepts/gameloop-architecture","permalink":"/docs/core-concepts/gameloop-architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/thorstensuckow/helios/tree/main/website/docs/core-concepts/gameloop-architecture.md","tags":[{"inline":true,"label":"gameplay","permalink":"/docs/tags/gameplay"},{"inline":true,"label":"architecture","permalink":"/docs/tags/architecture"}],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Game Loop Architecture","description":"Commands, Events, double-buffered EventBus, and ImmediateBus for decoupled game systems.","slug":"/core-concepts/gameloop-architecture","sidebar_label":"Game Loop","sidebar_position":4,"tags":["gameplay","architecture"],"keywords":["helios","game loop","commands","events","EventBus","CommandBuffer"]},"sidebar":"tutorialSidebar","previous":{"title":"Component System","permalink":"/docs/core-concepts/component-system"},"next":{"title":"State Management","permalink":"/docs/core-concepts/state-management"}}');var a=s(74848),i=s(28453);const r={title:"Game Loop Architecture",description:"Commands, Events, double-buffered EventBus, and ImmediateBus for decoupled game systems.",slug:"/core-concepts/gameloop-architecture",sidebar_label:"Game Loop",sidebar_position:4,tags:["gameplay","architecture"],keywords:["helios","game loop","commands","events","EventBus","CommandBuffer"]},o="Game Loop Architecture",d={},l=[{value:"Phase/Pass Structure",id:"phasepass-structure",level:2},{value:"State-Based Pass Filtering",id:"state-based-pass-filtering",level:2},{value:"GameState Parameter",id:"gamestate-parameter",level:3},{value:"Available States",id:"available-states",level:3},{value:"Evaluation",id:"evaluation",level:3},{value:"Practical Example: Twin-Stick Shooter",id:"practical-example-twin-stick-shooter",level:2},{value:"Execution Flow for One Frame",id:"execution-flow-for-one-frame",level:3},{value:"Key Observations",id:"key-observations",level:3},{value:"Commands and CommandBuffer",id:"commands-and-commandbuffer",level:2},{value:"Events and double-buffered EventBus",id:"events-and-double-buffered-eventbus",level:2},{value:"Frame Order Summary",id:"frame-order-summary",level:2},{value:"Immediate Events (single-buffered)",id:"immediate-events-single-buffered",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"game-loop-architecture",children:"Game Loop Architecture"})}),"\n",(0,a.jsxs)(n.p,{children:["helios distinguishes between ",(0,a.jsx)(n.strong,{children:"Commands"})," (world-mutating operations) and ",(0,a.jsx)(n.strong,{children:"Events"})," (signals/facts).\nCommands exist to mutate the world state ",(0,a.jsx)(n.em,{children:"deterministically"}),". Events exist to decouple systems: they either express a request/intent (e.g. ",(0,a.jsx)(n.code,{children:"SpawnCommand"}),") or a fact (e.g. ",(0,a.jsx)(n.code,{children:"SolidCollisionEvent"}),", ",(0,a.jsx)(n.code,{children:"TriggerCollisionEvent"}),", ",(0,a.jsx)(n.code,{children:"SpawnPlanCommandExecutedEvent"}),")."]}),"\n",(0,a.jsx)(n.h2,{id:"phasepass-structure",children:"Phase/Pass Structure"}),"\n",(0,a.jsxs)(n.p,{children:["The game loop is organized into ",(0,a.jsx)(n.strong,{children:"Phases"})," and ",(0,a.jsx)(n.strong,{children:"Passes"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                            FRAME                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                     \u2502\n\u2502  PRE PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Input) \u2500\u2500> Pass 2 (Commit) \u2500\u2500> Pass 3                    \u2502\n\u2502                            \u2502                                        \u2502\n\u2502                     [Pass Commit Point]                             \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502  MAIN PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Gameplay) \u2500\u2500> Pass 2 (Collision) \u2500\u2500> Pass 3 (AI)         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502  POST PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Scene Sync) \u2500\u2500> Pass 2 (Cleanup)                         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502                          RENDER                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Phases"})," are major segments (Pre, Main, Post) with distinct responsibilities. After each phase, a ",(0,a.jsx)(n.strong,{children:"Phase Commit"})," occurs: phase events become readable, pass events are cleared, commands are flushed, and managers process their queues."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Passes"})," are sub-units within phases. A pass can optionally have a ",(0,a.jsx)(n.strong,{children:"Commit Point"}),", making pass-level events readable in subsequent passes."]}),"\n",(0,a.jsxs)(n.p,{children:["For detailed event propagation rules, see ",(0,a.jsx)(n.a,{href:"/docs/core-concepts/event-system",children:"Event System"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"state-based-pass-filtering",children:"State-Based Pass Filtering"}),"\n",(0,a.jsx)(n.p,{children:"Passes can be configured to run only during specific game states. This allows gameplay systems to be automatically disabled during menus or paused states without explicit checks in each system."}),"\n",(0,a.jsx)(n.h3,{id:"gamestate-parameter",children:"GameState Parameter"}),"\n",(0,a.jsxs)(n.p,{children:["When adding a pass, you can specify which ",(0,a.jsx)(n.code,{children:"GameState"})," it should run in:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:"// This pass only runs when game is Running\ngameLoop.phase(PhaseType::Main)\n    .addPass(GameState::Running)\n        .addSystem<MovementSystem>()\n        .addSystem<CollisionSystem>();\n\n// This pass runs in all states (default)\ngameLoop.phase(PhaseType::Pre)\n    .addPass(GameState::Any)\n        .addSystem<InputSystem>();\n\n// This pass runs when paused OR running\ngameLoop.phase(PhaseType::Post)\n    .addPass(GameState::Running | GameState::Paused)\n        .addSystem<SceneSyncSystem>();\n"})}),"\n",(0,a.jsx)(n.h3,{id:"available-states",children:"Available States"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"State"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"GameState::Title"})}),(0,a.jsx)(n.td,{children:"Main menu / title screen"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"GameState::Running"})}),(0,a.jsx)(n.td,{children:"Active gameplay"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"GameState::Paused"})}),(0,a.jsx)(n.td,{children:"Game is paused"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"GameState::Any"})}),(0,a.jsx)(n.td,{children:"Runs in all states (default)"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"evaluation",children:"Evaluation"}),"\n",(0,a.jsxs)(n.p,{children:["During ",(0,a.jsx)(n.code,{children:"Phase::update()"}),", each pass checks if its configured state matches the current session state:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:"void update(UpdateContext& ctx, GameState currentState) {\n    for (auto& pass : passes_) {\n        if (hasFlag(pass->runsIn(), currentState)) {\n            pass->update(ctx);\n            // ... commit point handling\n        }\n    }\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["For the complete state management system including GameStateManager and MatchStateManager, see ",(0,a.jsx)(n.a,{href:"/docs/core-concepts/state-management",children:"State Management"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"practical-example-twin-stick-shooter",children:"Practical Example: Twin-Stick Shooter"}),"\n",(0,a.jsx)(n.p,{children:"The following example demonstrates how to configure a complete game loop for a twin-stick shooter with spawning, physics, collision, and rendering:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:"// Create core objects\nhelios::engine::runtime::gameloop::GameLoop gameLoop{};\nhelios::engine::runtime::world::GameWorld gameWorld{};\n\n// Register command dispatchers\ngameLoop.commandBuffer()\n    .addDispatcher<SpawnCommand>(\n        std::make_unique<SpawnCommandDispatcher>())\n    .addDispatcher<DespawnCommand>(\n        std::make_unique<DespawnCommandDispatcher>())\n    .addDispatcher<ScheduledSpawnPlanCommand>(\n        std::make_unique<ScheduledSpawnPlanCommandDispatcher>());\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PRE PHASE: Input, Spawning, Motion Preparation\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\ngameLoop.phase(PhaseType::Pre)\n    // Pass 1: Input handling (runs in all states)\n    .addPass(GameState::Any)\n    .addSystem<TwinStickInputSystem>(*playerGameObject)\n    \n    // Commit Point: Structural changes (spawn/despawn) execute here\n    .addCommitPoint(CommitPoint::Structural)\n    \n    // Pass 2: Spawn scheduling (only when Running)\n    .addPass(GameState::Running)\n    .addSystem<GameObjectSpawnSystem>(spawnSchedulers)\n    \n    // Commit Point: New entities are now active\n    .addCommitPoint(CommitPoint::Structural)\n    \n    // Pass 3: Motion systems (only when Running)\n    .addPass(GameState::Running)\n    .addSystem<ScaleSystem>()\n    .addSystem<SteeringSystem>()\n    .addSystem<SpinSystem>()\n    .addSystem<Move2DSystem>();\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// MAIN PHASE: Gameplay Logic, Collision, AI\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\ngameLoop.phase(PhaseType::Main)\n    // Pass 1: Update bounds and check collisions (only when Running)\n    .addPass(GameState::Running)\n    .addSystem<BoundsUpdateSystem>()\n    .addSystem<LevelBoundsBehaviorSystem>()\n    .addSystem<GridCollisionDetectionSystem>(cellSize, levelBounds)\n    \n    // Commit Point: Collision events become readable\n    .addCommitPoint()\n    \n    // Pass 2: React to collisions (only when Running)\n    .addPass(GameState::Running)\n    .addSystem<ProjectileCollisionSystem>()\n    .addSystem<EnemyCollisionSystem>();\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// POST PHASE: Scene Sync, Transform Cleanup\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\ngameLoop.phase(PhaseType::Post)\n    // Scene sync runs in all states (needed for UI updates while paused)\n    .addPass(GameState::Any)\n    .addSystem<ComposeTransformSystem>()\n    .addSystem<SceneSyncSystem>(scene.get())\n    .addSystem<TransformClearSystem>()\n    .addSystem<DelayedComponentEnablerSystem>();\n\n// Initialize and run\ngameWorld.init();\ngameLoop.init(gameWorld);\n\n// Main loop\nwhile (running) {\n    float deltaTime = /* calculate delta */;\n    \n    UpdateContext ctx{deltaTime, gameWorld, /* ... */};\n    gameLoop.update(ctx);\n    \n    render();\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"execution-flow-for-one-frame",children:"Execution Flow for One Frame"}),"\n",(0,a.jsx)(n.p,{children:"The following diagram shows how a projectile collision is processed:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Frame N\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPRE PHASE\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Pass 1: TwinStickInputSystem                                        \u2502\n\u2502   \u2192 Player presses fire button                                      \u2502\n\u2502   \u2192 Pushes ShootCommand to CommandBuffer                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 [Commit Point: Structural]                                          \u2502\n\u2502   \u2192 CommandBuffer.flush() executes ShootCommand                     \u2502\n\u2502   \u2192 SpawnManager creates projectile from pool                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Pass 2: GameObjectSpawnSystem                                       \u2502\n\u2502   \u2192 Evaluates spawn rules, schedules enemy spawns                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 [Commit Point: Structural]                                          \u2502\n\u2502   \u2192 New enemies spawned and activated                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Pass 3: Move2DSystem, SteeringSystem                                \u2502\n\u2502   \u2192 All entities (including new projectile) move                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n                      [Phase Commit]\n                              \u2193\nMAIN PHASE\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Pass 1: GridCollisionDetectionSystem                                \u2502\n\u2502   \u2192 Detects projectile-enemy collision                              \u2502\n\u2502   \u2192 Pushes TriggerCollisionEvent to Pass EventBus                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 [Commit Point]                                                      \u2502\n\u2502   \u2192 Pass events become readable                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Pass 2: ProjectileCollisionSystem                                   \u2502\n\u2502   \u2192 Reads TriggerCollisionEvent                                     \u2502\n\u2502   \u2192 Pushes DespawnCommand for projectile                            \u2502\n\u2502   \u2192 Pushes DamageCommand for enemy                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n                      [Phase Commit]\n                              \u2193\nPOST PHASE\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Pass 1: SceneSyncSystem                                             \u2502\n\u2502   \u2192 Syncs transforms to scene graph                                 \u2502\n\u2502   \u2192 Despawned projectile removed from scene                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n                      [Phase Commit]\n                      [Frame Commit]\n                              \u2193\n                          RENDER\n"})}),"\n",(0,a.jsx)(n.h3,{id:"key-observations",children:"Key Observations"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Commit Points control visibility"}),": The projectile spawned in Pre Phase Pass 1 is immediately available for physics in Pass 3 because of the structural commit point."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Pass events enable same-phase reactions"}),": The collision detected in Main Phase Pass 1 is readable in Pass 2, allowing the collision response in the same phase."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Commands execute at phase boundaries"}),": The ",(0,a.jsx)(n.code,{children:"DespawnCommand"})," pushed in Main Phase executes at the Main Phase Commit, so the entity is removed before rendering."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Deterministic ordering"}),": Systems within a pass execute in registration order. This ensures predictable behavior across frames."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"commands-and-commandbuffer",children:"Commands and CommandBuffer"}),"\n",(0,a.jsxs)(n.p,{children:["Systems can write Commands into the CommandBuffer during any phase. At each ",(0,a.jsx)(n.strong,{children:"Phase Commit"}),", the CommandBuffer is flushed \u2014 i.e., their ",(0,a.jsx)(n.code,{children:"execute()"})," method is invoked. This method contains the logic that mutates the world state (e.g., spawning, despawning, health changes, component changes)."]}),"\n",(0,a.jsx)(n.p,{children:"This means commands added during the Pre Phase are executed at the Pre Phase Commit, commands added during Main Phase at Main Phase Commit, and so on. This allows for responsive gameplay where actions taken in one phase are immediately visible in the next."}),"\n",(0,a.jsx)(n.p,{children:'Commands are "bare metal" and therefore the lowest level in the game-loop layer \u2014 no further preparation of a Command is required. The system should therefore also be able to commit Commands coming directly from a developer console into the GameWorld (optionally delegating them to their respective managers \u2014 see below).'}),"\n",(0,a.jsxs)(n.p,{children:["For detailed command handling, dispatchers, and manager integration, see ",(0,a.jsx)(n.a,{href:"/docs/core-concepts/command-system",children:"Command System"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"events-and-double-buffered-eventbus",children:"Events and double-buffered EventBus"}),"\n",(0,a.jsxs)(n.p,{children:["In addition, systems can emit Events in frame N, e.g. ",(0,a.jsx)(n.strong,{children:"request events"})," - events that intend to mutate the world state - or plain signals such as ",(0,a.jsx)(n.code,{children:"SolidCollisionEvent"}),", from which world-mutating Commands (despawn) can be derived."]}),"\n",(0,a.jsx)(n.p,{children:"helios provides three event buses with different visibility scopes:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Event Bus"}),(0,a.jsx)(n.th,{children:"Push Method"}),(0,a.jsx)(n.th,{children:"Read Method"}),(0,a.jsx)(n.th,{children:"Visibility"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Pass"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"pushPass<E>()"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"readPass<E>()"})}),(0,a.jsx)(n.td,{children:"Subsequent passes (same phase)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Phase"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"pushPhase<E>()"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"readPhase<E>()"})}),(0,a.jsx)(n.td,{children:"Next phase"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Frame"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"pushFrame<E>()"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"readFrame<E>()"})}),(0,a.jsx)(n.td,{children:"Next frame"})]})]})]}),"\n",(0,a.jsxs)(n.p,{children:["All buses are double-buffered (",(0,a.jsx)(n.code,{children:"helios.core.buffer.TypeIndexedDoubleBuffer"}),"): events are written into the write buffer and become visible in the read buffer only after a buffer swap."]}),"\n",(0,a.jsxs)(n.p,{children:["For detailed event propagation rules and commit points, see ",(0,a.jsx)(n.a,{href:"/docs/core-concepts/event-system",children:"Event System"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"frame-order-summary",children:"Frame Order Summary"}),"\n",(0,a.jsx)(n.p,{children:"At each phase boundary, the following commit sequence occurs:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:"// After each phase completes\nphaseEventBus.swapBuffers();    // Phase events become readable\npassEventBus.clearAll();         // Pass events are cleared\ncommandBuffer.flush();           // Commands execute (mutations)\ngameWorld.flushManagers();       // Managers process queued requests\n\n// Additionally, at the end of Post phase:\nframeEventBus.swapBuffers();     // Frame events become readable in next frame\n"})}),"\n",(0,a.jsx)(n.p,{children:"Overall frame execution:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:"for (phase : {Pre, Main, Post}) {\n    \n    for (pass : phase.passes()) {\n        for (system : pass.systems()) {\n            system.update(updateContext);\n        }\n        \n        if (pass.commitPoint() == CommitPoint::PassEvents) {\n            passEventBus.swapBuffers();  // Pass events readable\n        }\n    }\n    \n    phaseCommit();  // Phase boundary\n    \n    if (phase == Post) {\n        frameEventBus.swapBuffers();  // Frame events readable in next frame\n    }\n}\n\nrender();\n"})}),"\n",(0,a.jsx)(n.h2,{id:"immediate-events-single-buffered",children:"Immediate Events (single-buffered)"}),"\n",(0,a.jsxs)(n.p,{children:["For time-critical feedback that does not mutate the world state (particle effects, audio feedback), there is a separate ",(0,a.jsx)(n.strong,{children:"ImmediateBus"})," (single-buffered).\nImmediate events should be processed within the same frame without additional double-buffer latency. A suitable dispatch point is after ",(0,a.jsx)(n.code,{children:"CommandBuffer.flush()"}),', so that feedback can observe the world that was committed at the beginning of the frame in a consistent state. This mitigates latency (e.g. ~16ms at 60fps) and allows feedback to be triggered in the same frame as a specific event, which improves the overall user experience ("game feel").']}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/core-concepts/command-system",children:"Command System"})," \u2014 Command pattern, dispatchers, managers"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/core-concepts/event-system",children:"Event System"})," \u2014 Phase/Pass event propagation with double-buffered buses"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/core-concepts/state-management",children:"State Management"})," \u2014 Game and match state transitions"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/core-concepts/component-system",children:"Component System"})," \u2014 ECS-style composition architecture"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/core-concepts/spawn-system",children:"Spawn System"})," \u2014 Entity lifecycle with spawn scheduling and pooling"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);