"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[63560],{28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>i});var t=n(96540);const a={},r=t.createContext(a);function o(e){const s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(r.Provider,{value:s},e.children)}},35214:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"core-concepts/gameloop-architecture","title":"Game Loop Architecture","description":"Commands, Events, double-buffered EventBus, and ImmediateBus for decoupled game systems.","source":"@site/docs/core-concepts/gameloop-architecture.md","sourceDirName":"core-concepts","slug":"/core-concepts/gameloop-architecture","permalink":"/docs/core-concepts/gameloop-architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/thorstensuckow/helios/tree/main/website/docs/core-concepts/gameloop-architecture.md","tags":[{"inline":true,"label":"gameplay","permalink":"/docs/tags/gameplay"},{"inline":true,"label":"architecture","permalink":"/docs/tags/architecture"}],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Game Loop Architecture","description":"Commands, Events, double-buffered EventBus, and ImmediateBus for decoupled game systems.","slug":"/core-concepts/gameloop-architecture","sidebar_label":"Game Loop","sidebar_position":4,"tags":["gameplay","architecture"],"keywords":["helios","game loop","commands","events","EventBus","CommandBuffer"]},"sidebar":"tutorialSidebar","previous":{"title":"Component System","permalink":"/docs/core-concepts/component-system"},"next":{"title":"Command System","permalink":"/docs/core-concepts/command-system"}}');var a=n(74848),r=n(28453);const o={title:"Game Loop Architecture",description:"Commands, Events, double-buffered EventBus, and ImmediateBus for decoupled game systems.",slug:"/core-concepts/gameloop-architecture",sidebar_label:"Game Loop",sidebar_position:4,tags:["gameplay","architecture"],keywords:["helios","game loop","commands","events","EventBus","CommandBuffer"]},i="Game Loop Architecture",d={},c=[{value:"Phase/Pass Structure",id:"phasepass-structure",level:2},{value:"Commands and CommandBuffer",id:"commands-and-commandbuffer",level:2},{value:"Events and double-buffered EventBus",id:"events-and-double-buffered-eventbus",level:2},{value:"Frame Order Summary",id:"frame-order-summary",level:2},{value:"Immediate Events (single-buffered)",id:"immediate-events-single-buffered",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function l(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"game-loop-architecture",children:"Game Loop Architecture"})}),"\n",(0,a.jsxs)(s.p,{children:["helios distinguishes between ",(0,a.jsx)(s.strong,{children:"Commands"})," (world-mutating operations) and ",(0,a.jsx)(s.strong,{children:"Events"})," (signals/facts).\nCommands exist to mutate the world state ",(0,a.jsx)(s.em,{children:"deterministically"}),". Events exist to decouple systems: they either express a request/intent (e.g. SpawnRequest) or a fact (e.g. ",(0,a.jsx)(s.code,{children:"SolidCollisionEvent"}),", ",(0,a.jsx)(s.code,{children:"TriggerCollisionEvent"}),", ",(0,a.jsx)(s.code,{children:"SpawnedEvent"}),")."]}),"\n",(0,a.jsx)(s.h2,{id:"phasepass-structure",children:"Phase/Pass Structure"}),"\n",(0,a.jsxs)(s.p,{children:["The game loop is organized into ",(0,a.jsx)(s.strong,{children:"Phases"})," and ",(0,a.jsx)(s.strong,{children:"Passes"}),":"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                            FRAME                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                     \u2502\n\u2502  PRE PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Input) \u2500\u2500> Pass 2 (Commit) \u2500\u2500> Pass 3                    \u2502\n\u2502                            \u2502                                        \u2502\n\u2502                     [Pass Commit Point]                             \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502  MAIN PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Gameplay) \u2500\u2500> Pass 2 (Collision) \u2500\u2500> Pass 3 (AI)         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502  POST PHASE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Pass 1 (Scene Sync) \u2500\u2500> Pass 2 (Cleanup)                         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Phase Commit    \u2502\n\u2502                                                                     \u2502\n\u2502                          RENDER                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Phases"})," are major segments (Pre, Main, Post) with distinct responsibilities. After each phase, a ",(0,a.jsx)(s.strong,{children:"Phase Commit"})," occurs: phase events become readable, pass events are cleared, commands are flushed, and managers process their queues."]}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Passes"})," are sub-units within phases. A pass can optionally have a ",(0,a.jsx)(s.strong,{children:"Commit Point"}),", making pass-level events readable in subsequent passes."]}),"\n",(0,a.jsxs)(s.p,{children:["For detailed event propagation rules, see ",(0,a.jsx)(s.a,{href:"/docs/core-concepts/event-system",children:"Event System"}),"."]}),"\n",(0,a.jsx)(s.h2,{id:"commands-and-commandbuffer",children:"Commands and CommandBuffer"}),"\n",(0,a.jsxs)(s.p,{children:["Participating systems can write Commands into the CommandBuffer in frame N.\nAt the beginning of each frame N+1, the CommandBuffer is flushed, which commits the Commands - i.e. their ",(0,a.jsx)(s.code,{children:"execute()"}),' method is invoked. This method contains the logic that mutates the world state (e.g. spawning, despawning, health changes, component changes). Commands are "bare metal" and therefore the lowest level in the game-loop layer, i.e. no further preparation of a Command is required. The system should therefore also be able to commit Commands coming directly from a developer console into the GameWorld (optionally delegating them to their respective managers - see below).']}),"\n",(0,a.jsxs)(s.p,{children:["For detailed command handling, dispatchers, and manager integration, see ",(0,a.jsx)(s.a,{href:"/docs/core-concepts/command-system",children:"Command System"}),"."]}),"\n",(0,a.jsx)(s.h2,{id:"events-and-double-buffered-eventbus",children:"Events and double-buffered EventBus"}),"\n",(0,a.jsxs)(s.p,{children:["In addition, systems can emit Events in frame N, e.g. ",(0,a.jsx)(s.strong,{children:"request events"})," - events that intend to mutate the world state - or plain signals such as ",(0,a.jsx)(s.code,{children:"SolidCollisionEvent"}),", from which world-mutating Commands (despawn) can be derived."]}),"\n",(0,a.jsx)(s.p,{children:"helios provides two event buses with different visibility scopes:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Event Bus"}),(0,a.jsx)(s.th,{children:"Push Method"}),(0,a.jsx)(s.th,{children:"Read Method"}),(0,a.jsx)(s.th,{children:"Visibility"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Phase"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"pushPhase<E>()"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"readPhase<E>()"})}),(0,a.jsx)(s.td,{children:"Next phase"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Pass"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"pushPass<E>()"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"readPass<E>()"})}),(0,a.jsx)(s.td,{children:"Subsequent passes (same phase)"})]})]})]}),"\n",(0,a.jsxs)(s.p,{children:["Both buses are double-buffered (",(0,a.jsx)(s.code,{children:"helios.core.buffer.TypeIndexedDoubleBuffer"}),"): events are written into the write buffer and become visible in the read buffer only after a buffer swap."]}),"\n",(0,a.jsxs)(s.p,{children:["For detailed event propagation rules and commit points, see ",(0,a.jsx)(s.a,{href:"/docs/core-concepts/event-system",children:"Event System"}),"."]}),"\n",(0,a.jsx)(s.h2,{id:"frame-order-summary",children:"Frame Order Summary"}),"\n",(0,a.jsx)(s.p,{children:"At each phase boundary, the following commit sequence occurs:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-cpp",children:"// After each phase completes\nphaseEventBus.swapBuffers();    // Phase events become readable\npassEventBus.clearAll();         // Pass events are cleared\ncommandBuffer.flush();           // Commands execute (mutations)\ngameWorld.flushManagers();       // Managers process queued requests\n"})}),"\n",(0,a.jsx)(s.p,{children:"Overall frame execution:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-cpp",children:"for (phase : {Pre, Main, Post}) {\n    \n    for (pass : phase.passes()) {\n        for (system : pass.systems()) {\n            system.update(updateContext);\n        }\n        \n        if (pass.hasCommitPoint()) {\n            passEventBus.swapBuffers();  // Pass events readable\n        }\n    }\n    \n    phaseCommit();  // Phase boundary\n}\n\nrender();\n"})}),"\n",(0,a.jsx)(s.h2,{id:"immediate-events-single-buffered",children:"Immediate Events (single-buffered)"}),"\n",(0,a.jsxs)(s.p,{children:["For time-critical feedback that does not mutate the world state (particle effects, audio feedback), there is a separate ",(0,a.jsx)(s.strong,{children:"ImmediateBus"})," (single-buffered).\nImmediate events should be processed within the same frame without additional double-buffer latency. A suitable dispatch point is after ",(0,a.jsx)(s.code,{children:"CommandBuffer.flush()"}),', so that feedback can observe the world that was committed at the beginning of the frame in a consistent state. This mitigates latency (e.g. ~16ms at 60fps) and allows feedback to be triggered in the same frame as a specific event, which improves the overall user experience ("game feel").']}),"\n",(0,a.jsx)(s.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.a,{href:"/docs/core-concepts/command-system",children:"Command System"})," \u2014 Command pattern, dispatchers, managers"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.a,{href:"/docs/core-concepts/event-system",children:"Event System"})," \u2014 Phase/Pass event propagation with double-buffered buses"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.a,{href:"/docs/core-concepts/component-system",children:"Component System"})," \u2014 ECS-style composition architecture"]}),"\n"]})]})}function m(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);