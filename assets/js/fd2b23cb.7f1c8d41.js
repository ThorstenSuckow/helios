"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[49775],{10566:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"core-concepts/ecs/entity-registry","title":"EntityRegistry","description":"Single source of truth for entity lifecycle with versioned handles and index recycling.","source":"@site/docs/core-concepts/ecs/entity-registry.md","sourceDirName":"core-concepts/ecs","slug":"/core-concepts/ecs/entity-registry","permalink":"/docs/core-concepts/ecs/entity-registry","draft":false,"unlisted":false,"editUrl":"https://github.com/thorstensuckow/helios/tree/main/website/docs/core-concepts/ecs/entity-registry.md","tags":[{"inline":true,"label":"ecs","permalink":"/docs/tags/ecs"},{"inline":true,"label":"architecture","permalink":"/docs/tags/architecture"},{"inline":true,"label":"registry","permalink":"/docs/tags/registry"}],"version":"current","sidebarPosition":3,"frontMatter":{"title":"EntityRegistry","description":"Single source of truth for entity lifecycle with versioned handles and index recycling.","slug":"/core-concepts/ecs/entity-registry","sidebar_label":"EntityRegistry","sidebar_position":3,"tags":["ecs","architecture","registry"],"keywords":["helios","EntityRegistry","ECS","versioned handles","entity lifecycle"]},"sidebar":"tutorialSidebar","previous":{"title":"EntityManager","permalink":"/docs/core-concepts/ecs/entity-manager"},"next":{"title":"EntityHandle","permalink":"/docs/core-concepts/ecs/entity-handle"}}');var t=i(74848),s=i(28453);const c={title:"EntityRegistry",description:"Single source of truth for entity lifecycle with versioned handles and index recycling.",slug:"/core-concepts/ecs/entity-registry",sidebar_label:"EntityRegistry",sidebar_position:3,tags:["ecs","architecture","registry"],keywords:["helios","EntityRegistry","ECS","versioned handles","entity lifecycle"]},l="EntityRegistry",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"API Reference",id:"api-reference",level:2},{value:"Construction",id:"construction",level:3},{value:"Entity Creation",id:"entity-creation",level:3},{value:"Entity Destruction",id:"entity-destruction",level:3},{value:"Validation",id:"validation",level:3},{value:"Version Query",id:"version-query",level:3},{value:"Versioning System",id:"versioning-system",level:2},{value:"Index Recycling",id:"index-recycling",level:2},{value:"Thread Safety",id:"thread-safety",level:2},{value:"Performance",id:"performance",level:2},{value:"See Also",id:"see-also",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"entityregistry",children:"EntityRegistry"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"EntityRegistry"})," is the single source of truth for entity lifecycle management in the helios ECS. It handles entity creation, destruction, and validation through versioned handles."]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The registry is responsible for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handle Allocation"})," - Generates unique ",(0,t.jsx)(n.code,{children:"EntityHandle"})," instances"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Version Tracking"})," - Maintains version numbers for stale handle detection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Index Recycling"})," - Reuses destroyed entity indices via a free list"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validation"})," - Determines if a handle refers to a living entity"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"EntityRegistry registry;\n\n// Create entity\nauto handle = registry.create();  // {entityId: 0, versionId: 1}\n\n// Validate\nif (registry.isValid(handle)) {\n    // Entity is alive\n}\n\n// Destroy\nregistry.destroy(handle);\n\n// Handle is now stale\nassert(!registry.isValid(handle));\n"})}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     EntityRegistry                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  versions_: [1, 2, 1, 1, 3, ...]                            \u2502\n\u2502              \u2502  \u2502  \u2502  \u2502  \u2502                                  \u2502\n\u2502              \u2502  \u2502  \u2502  \u2502  \u2514\u2500 Entity 4: version 3 (recycled)  \u2502\n\u2502              \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500 Entity 3: version 1 (alive)     \u2502\n\u2502              \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Entity 2: version 1 (alive)     \u2502\n\u2502              \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Entity 1: version 2 (recycled)  \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Entity 0: version 1 (alive)     \u2502\n\u2502                                                             \u2502\n\u2502  freeList_: [1]  \u2190 Recycled indices available for reuse     \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,t.jsx)(n.h3,{id:"construction",children:"Construction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// Default constructor\nEntityRegistry registry;\n\n// With pre-allocated capacity\nEntityRegistry registry(1000);  // Reserve space for 1000 entities\n"})}),"\n",(0,t.jsx)(n.h3,{id:"entity-creation",children:"Entity Creation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"EntityHandle create();\n"})}),"\n",(0,t.jsx)(n.p,{children:"Creates a new entity and returns its handle:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If the free list has recycled indices, one is reused"}),"\n",(0,t.jsx)(n.li,{children:"Otherwise, a new index is allocated"}),"\n",(0,t.jsx)(n.li,{children:"New entities start with version 1"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"auto e1 = registry.create();  // {0, 1}\nauto e2 = registry.create();  // {1, 1}\nauto e3 = registry.create();  // {2, 1}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"entity-destruction",children:"Entity Destruction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"bool destroy(const EntityHandle handle);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Destroys the entity:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Increments the version (invalidates existing handles)"}),"\n",(0,t.jsx)(n.li,{children:"Adds the index to the free list"}),"\n",(0,t.jsxs)(n.li,{children:["Returns ",(0,t.jsx)(n.code,{children:"false"})," if handle was already invalid"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"registry.destroy(e2);\n// e2's index (1) is now in free list\n// Next create() will reuse index 1 with version 2\n\nauto e4 = registry.create();  // {1, 2} - recycled index\n"})}),"\n",(0,t.jsx)(n.h3,{id:"validation",children:"Validation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"bool isValid(const EntityHandle handle) const noexcept;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Checks if a handle refers to a living entity:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"auto handle = registry.create();\nregistry.isValid(handle);  // true\n\nregistry.destroy(handle);\nregistry.isValid(handle);  // false (version mismatch)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"version-query",children:"Version Query"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"VersionId version(EntityId entityId) const;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Returns the current version for an entity index:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"auto handle = registry.create();        // {5, 1}\nregistry.version(5);                    // 1\n\nregistry.destroy(handle);\nregistry.version(5);                    // 2 (incremented)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"versioning-system",children:"Versioning System"}),"\n",(0,t.jsxs)(n.p,{children:["The versioning system prevents the ",(0,t.jsx)(n.strong,{children:"ABA problem"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Timeline:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. create()     \u2192 Handle {id:0, ver:1}    versions_[0] = 1\n2. destroy()    \u2192 Index 0 freed           versions_[0] = 2\n3. create()     \u2192 Handle {id:0, ver:2}    (recycled)\n4. Old handle {id:0, ver:1} is STALE      (ver 1 \u2260 ver 2)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n"})}),"\n",(0,t.jsx)(n.h2,{id:"index-recycling",children:"Index Recycling"}),"\n",(0,t.jsx)(n.p,{children:"Destroyed indices are recycled to keep memory compact:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"auto a = registry.create();  // {0, 1}\nauto b = registry.create();  // {1, 1}\nauto c = registry.create();  // {2, 1}\n\nregistry.destroy(b);         // freeList_ = [1]\nregistry.destroy(a);         // freeList_ = [1, 0]\n\nauto d = registry.create();  // {0, 2} - reuses index 0\nauto e = registry.create();  // {1, 2} - reuses index 1\n"})}),"\n",(0,t.jsx)(n.h2,{id:"thread-safety",children:"Thread Safety"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"EntityRegistry"})," is ",(0,t.jsx)(n.strong,{children:"not thread-safe"}),". All operations must be performed from a single thread or externally synchronized."]}),"\n",(0,t.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Operation"}),(0,t.jsx)(n.th,{children:"Complexity"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"create()"})}),(0,t.jsx)(n.td,{children:"O(1)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"destroy()"})}),(0,t.jsx)(n.td,{children:"O(1)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"isValid()"})}),(0,t.jsx)(n.td,{children:"O(1)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"version()"})}),(0,t.jsx)(n.td,{children:"O(1)"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/core-concepts/ecs/entity-handle",children:"EntityHandle"})," - Versioned entity reference"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/core-concepts/ecs/entity-manager",children:"EntityManager"})," - Combines registry with component storage"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/core-concepts/ecs/gameobject",children:"GameObject"})," - High-level entity wrapper"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var r=i(96540);const t={},s=r.createContext(t);function c(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);